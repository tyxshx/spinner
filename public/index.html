<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spin & Win</title>

<!-- Base CSS + Admin Panel + Wheel Styling -->
<style>
:root {
    --bg-dark: #0d0f17;
    --panel-dark: #1a1d29;
    --text-dark: #ffffff;

    --bg-light: #f5f6fa;
    --panel-light: #ffffff;
    --text-light: #222222;

    --accent: #ff4d4d;
    --accent-glow: rgba(255, 77, 77, 0.6);
}

/* Responsive Reset */
html, body {
    margin: 0;
    padding: 0;
    overflow-x: hidden;
    font-family: "Inter", sans-serif;
    background: var(--bg-dark);
    color: var(--text-dark);
    transition: background 0.3s ease, color 0.3s ease;
}

/* Mobile scaling */
#wheelContainer {
    width: 100%;
    max-width: 460px;
    margin: 0 auto;
    text-align: center;
}

canvas#wheelCanvas {
    width: 100%;
    height: auto;
}

/* Header */
.app-title {
    text-align: center;
    margin-top: 20px;
    font-size: 32px;
    font-weight: 700;
}

/* Name input + spin button */
.input-area {
    width: 90%;
    max-width: 420px;
    margin: 20px auto;
}

.input-area input {
    width: 100%;
    padding: 12px 14px;
    border-radius: 8px;
    border: none;
    margin-bottom: 10px;
    background: rgba(255,255,255,0.1);
    color: white;
    font-size: 16px;
}

.spin-btn {
    width: 100%;
    padding: 14px;
    border: none;
    border-radius: 10px;
    background: linear-gradient(90deg, #ff5a5a, #ff2e2e);
    color: white;
    font-size: 20px;
    font-weight: 600;
    cursor: pointer;
    transition: 0.2s;
}
.spin-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* Pointer */
.pointer {
    width: 0;
    height: 0;
    border-left: 18px solid transparent;
    border-right: 18px solid transparent;
    border-bottom: 32px solid white;
    margin: 10px auto;
    animation: glow 1.4s infinite alternate;
}
@keyframes glow {
    0% { filter: drop-shadow(0 0 3px var(--accent)); }
    100% { filter: drop-shadow(0 0 12px var(--accent)); }
}

/* Admin login panel */
#adminLoginScreen {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.75);
    backdrop-filter: blur(6px);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 9999;
}

.login-box {
    background: var(--panel-dark);
    border-radius: 14px;
    padding: 30px;
    width: 90%;
    max-width: 380px;
    color: var(--text-dark);
    box-shadow: 0 0 20px rgba(0,0,0,0.45);
}

.login-box h2 {
    margin: 0 0 15px;
    text-align: center;
}

.login-box input {
    width: 100%;
    padding: 12px;
    border-radius: 7px;
    border: none;
    margin-top: 10px;
    background: rgba(255,255,255,0.12);
    color: var(--text-dark);
}

.login-submit {
    width: 100%;
    margin-top: 18px;
    padding: 12px;
    background: var(--accent);
    border: none;
    border-radius: 8px;
    color: white;
    font-size: 17px;
    cursor: pointer;
}

/* Hidden hotspot */
#adminHotspot {
    position: fixed;
    top: 0;
    right: 0;
    width: 50px;
    height: 50px;
    z-index: 50;
}

/* Sliding Admin Panel */
#adminPanel {
    position: fixed;
    top: 0; right: -420px;
    width: 420px;
    height: 100%;
    background: var(--panel-dark);
    color: var(--text-dark);
    box-shadow: -4px 0 14px rgba(0,0,0,0.4);
    transition: right 0.35s ease;
    z-index: 9998;
    padding: 20px;
    overflow-y: auto;
}

#adminPanel.open {
    right: 0;
}

.admin-title {
    font-size: 24px;
    font-weight: 700;
    margin-bottom: 14px;
}

/* Tab buttons */
.tab-buttons {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
}
.tab-buttons button {
    flex: 1;
    padding: 10px;
    border-radius: 8px;
    border: none;
    background: rgba(255,255,255,0.12);
    color: var(--text-dark);
    font-size: 15px;
    cursor: pointer;
}
.tab-buttons button.active {
    background: var(--accent);
    color: white;
}

/* Tab content area */
.admin-tab {
    display: none;
}
.admin-tab.active {
    display: block;
}

/* Winners table */
.winners-table {
    width: 100%;
    border-collapse: collapse;
}
.winners-table th, .winners-table td {
    padding: 8px;
    border-bottom: 1px solid rgba(255,255,255,0.15);
}
.winners-table th {
    text-align: left;
}
/* Light theme overrides */
body.light {
    background: var(--bg-light);
    color: var(--text-light);
}
body.light #adminPanel {
    background: var(--panel-light);
    color: var(--text-light);
}
body.light .login-box {
    background: var(--panel-light);
    color: var(--text-light);
}
body.light input {
    background: rgba(0,0,0,0.08);
    color: var(--text-light);
}
body.light .tab-buttons button {
    background: rgba(0,0,0,0.08);
    color: var(--text-light);
}
body.light .tab-buttons button.active {
    background: var(--accent);
    color: white;
}

/* Modals */
#limitModal {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.65);
    backdrop-filter: blur(4px);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 9000;
}
.limit-box {
    background: #300;
    border-radius: 14px;
    padding: 28px;
    text-align: center;
    color: white;
    width: 90%;
    max-width: 360px;
    animation: pop 0.3s ease;
}
@keyframes pop {
    from { transform: scale(0.6); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
}

/* Confetti canvas */
#confettiCanvas {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none;
    z-index: 10;
}
</style>
</head>

<body>

<!-- Confetti -->
<canvas id="confettiCanvas"></canvas>

<!-- Hidden Admin Hotspot -->
<div id="adminHotspot"></div>

<!-- Exhausted Limit Modal -->
<div id="limitModal">
    <div class="limit-box">
        <h2>Oops! Spin Limit Exhausted</h2>
        <p>You have reached your 3 spins for today.</p>
        <button onclick="closeLimitModal()" style="
            margin-top:15px;
            padding:10px 18px;
            background:#ff4d4d;
            border:none;
            border-radius:8px;
            color:white;
            cursor:pointer;">
            OK
        </button>
    </div>
</div>

<!-- Admin Login Screen -->
<div id="adminLoginScreen">
    <div class="login-box">
        <h2>Admin Login</h2>
        <input id="adminUser" placeholder="Username: admin">
        <input id="adminPass" type="password" placeholder="Password">
        <button class="login-submit" onclick="attemptAdminLogin()">Login</button>
    </div>
</div>

<!-- Sliding Admin Panel -->
<div id="adminPanel">
    <div class="admin-title">Admin Dashboard</div>
<button onclick="adminLogout()" style="
    width:100%; padding:10px; margin-bottom:10px;
    border:none; border-radius:8px;
    background:#444; color:white;">
    Logout
</button>


    <!-- Tabs -->
    <div class="tab-buttons">
        <button id="tabPrizesBtn" onclick="switchTab('prizes')">Prizes</button>
        <button id="tabDisplayBtn" onclick="switchTab('display')">Display Count</button>
        <button id="tabThemeBtn" onclick="switchTab('theme')">Theme</button>
        <button id="tabResetBtn" onclick="switchTab('limits')">Spin Reset</button>
        <button id="tabWinnersBtn" onclick="switchTab('winners')">Winners</button>
    </div>

    <!-- Prizes Tab -->
    <div id="tabPrizes" class="admin-tab">
        <h3>Manage Prizes</h3>
        <div id="prizeListContainer"></div>

        <button onclick="addPrizeField()" style="
            margin-top:15px;
            padding:10px;
            width:100%;
            background:var(--accent);
            color:white;
            border:none;
            border-radius:8px;">
            + Add Prize
        </button>

        <button onclick="saveAllPrizes()" style="
            margin-top:10px;
            padding:10px;
            width:100%;
            background:#1ecb68;
            color:white;
            border:none;
            border-radius:8px;">
            Save Prizes
        </button>
    </div>

    <!-- Display Count Tab -->
    <div id="tabDisplay" class="admin-tab">
        <h3>Prizes Displayed on Wheel</h3>
        <input id="displayCountInput" type="number" min="1" style="
            width:100%; padding:10px; border-radius:8px; border:none; background:rgba(255,255,255,0.15); color:white;">
        <button onclick="saveDisplayCount()" style="
            margin-top:12px;
            width:100%;
            padding:10px;
            background:#1ecb68;
            border:none;
            border-radius:8px;
            color:white;">
            Save Display Count
        </button>
    </div>

    <!-- Theme Tab -->
    <div id="tabTheme" class="admin-tab">
        <h3>Theme</h3>
        <button onclick="setTheme('dark')" style="
            width:100%; padding:12px; border-radius:8px; border:none;
            background:#222; color:white; margin-bottom:10px;">Dark Mode</button>

        <button onclick="setTheme('light')" style="
            width:100%; padding:12px; border-radius:8px; border:none;
            background:#ddd; color:#222;">Light Mode</button>
    </div>

    <!-- Reset Limits Tab -->
    <div id="tabLimits" class="admin-tab">
        <h3>Reset Spin Limits</h3>

        <button onclick="resetLocalSpinLimit()" style="
            width:100%; padding:12px; margin-bottom:10px;
            border:none; border-radius:8px; background:#ff4d4d; color:white;">
            Reset My Browser Spins
        </button>

        <button onclick="broadcastGlobalSpinReset()" style="
            width:100%; padding:12px; border:none; border-radius:8px;
            background:#ff2e2e; color:white;">
            Reset All Users Spins
        </button>
    </div>

    <!-- Winners Tab -->
    <div id="tabWinners" class="admin-tab">
        <h3>Today's Winners</h3>
        <div id="winnersContainer">Loading...</div>
    </div>

</div>

<!-- Main App Title -->
<h1 class="app-title">Spin & Win ðŸŽ‰</h1>

<!-- Wheel Section -->
<div id="wheelContainer">
    <canvas id="wheelCanvas" width="500" height="500"></canvas>
    <div class="pointer"></div>
</div>

<!-- User Input -->
<div class="input-area">
    <input id="usernameInput" placeholder="Enter your name">
    <button id="spinButton" class="spin-btn" disabled>Spin the Wheel</button>
</div>

<!-- Result -->
<div style="text-align:center; margin-top:20px;">
    <div id="resultDisplay" style="font-size:20px; font-weight:600;"></div>
    <div id="logStatus" style="color:#7dff9c; margin-top:6px;"></div>
</div>
<script>
/* ============================================================
   GLOBAL CONSTANTS + PASSWORD HASH
============================================================ */
const ADMIN_USERNAME = "admin";

// Your hashed password (SHA-256 of "4dm!n@123*&%")
const ADMIN_PASSWORD_HASH =
  "a318ded239ed24ae68f09c35e21e8db313f088aea3d014df43535078146cfccc";

// API endpoints (serverless routes â€” safe to expose)
const API_PRIZES = "/api/prizes";
const API_SAVE_PRIZES = "/api/save-prizes";
const API_WINNERS = "/api/winners";

// Wheel state variables
let PRIZES = [];
let DISPLAY_COUNT = 0;
let CURRENT_THEME = "dark";

// Admin authentication flag
let adminLoggedIn = false;

// Utility: SHA-256 hashing for login
async function sha256(str) {
    const encoded = new TextEncoder().encode(str);
    const hashBuffer = await crypto.subtle.digest("SHA-256", encoded);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    return hashArray.map(b => b.toString(16).padStart(2, "0")).join("");
}

/* ============================================================
   ADMIN LOGIN HANDLING
============================================================ */
function openAdminLogin() {
    document.getElementById("adminLoginScreen").style.display = "flex";
}

async function attemptAdminLogin() {
    const user = document.getElementById("adminUser").value.trim();
    const pass = document.getElementById("adminPass").value;

    if (user !== ADMIN_USERNAME) {
        alert("Incorrect username");
        return;
    }

    const hash = await sha256(pass);
    if (hash !== ADMIN_PASSWORD_HASH) {
        alert("Incorrect password");
        return;
    }

    adminLoggedIn = true;
    document.getElementById("adminLoginScreen").style.display = "none";
    openAdminPanel();
}

function adminLogout() {
    adminLoggedIn = false;
    closeAdminPanel();
    alert("You have been logged out.");
}

/* Hidden hotspot triggers login screen */
document.getElementById("adminHotspot").addEventListener("click", () => {
    if (!adminLoggedIn) openAdminLogin();
});

/* Shift + A opens login */
document.addEventListener("keydown", (e) => {
    if (e.shiftKey && e.key.toLowerCase() === "a") {
        if (!adminLoggedIn) openAdminLogin();
        else openAdminPanel();
    }
});

/* ============================================================
   ADMIN PANEL SLIDE-IN CONTROL
============================================================ */
function openAdminPanel() {
    document.getElementById("adminPanel").classList.add("open");
}
function closeAdminPanel() {
    document.getElementById("adminPanel").classList.remove("open");
}

/* ============================================================
   TAB SWITCHING
============================================================ */
function switchTab(tab) {
    document.querySelectorAll(".admin-tab").forEach(t => t.classList.remove("active"));
    document.querySelectorAll(".tab-buttons button").forEach(b => b.classList.remove("active"));

    document.getElementById("tab" + capitalize(tab)).classList.add("active");
    document.getElementById("tab" + capitalize(tab) + "Btn").classList.add("active");

    if (tab === "winners") loadWinners();
}

function capitalize(s) { return s.charAt(0).toUpperCase() + s.slice(1); }

/* ============================================================
   FETCH GLOBAL PRIZES, DISPLAY COUNT, THEME
============================================================ */
async function loadGlobalSettings() {
    try {
        const res = await fetch(API_PRIZES);
        const data = await res.json();

        PRIZES = data.prizes || [];
        DISPLAY_COUNT = data.displayCount || PRIZES.length;
        CURRENT_THEME = data.theme || "dark";

        applyTheme(CURRENT_THEME);
        populatePrizeEditor();
        document.getElementById("displayCountInput").value = DISPLAY_COUNT;

        drawWheel();
    } catch (e) {
        console.error("Failed loading settings:", e);
    }
}

/* ============================================================
   THEME HANDLING
============================================================ */
function applyTheme(theme) {
    document.body.classList.remove("light");
    if (theme === "light") document.body.classList.add("light");
}

async function setTheme(theme) {
    CURRENT_THEME = theme;
    applyTheme(theme);
    await saveAllPrizes(); // saves theme along with prizes
}

/* ============================================================
   PRIZE EDITOR UI
============================================================ */
function populatePrizeEditor() {
    const container = document.getElementById("prizeListContainer");
    container.innerHTML = "";

    PRIZES.forEach((p, i) => {
        const row = document.createElement("div");
        row.style.marginBottom = "8px";

        row.innerHTML = `
            <input value="${p}" data-index="${i}" style="
                width:78%;
                padding:10px;
                border:none;
                border-radius:8px;
                margin-right:5px;
                background:rgba(255,255,255,0.15);
                color:white;">
            <button onclick="deletePrize(${i})" style="
                width:18%;
                padding:8px;
                border:none;
                border-radius:8px;
                background:#ff4d4d;
                color:white;">
                X
            </button>
        `;
        container.appendChild(row);
    });
}

function addPrizeField() {
    PRIZES.push("New Prize");
    populatePrizeEditor();
}

/* Delete a prize */
function deletePrize(index) {
    PRIZES.splice(index, 1);
    populatePrizeEditor();
}

/* ============================================================
   SAVE PRIZES + DISPLAY COUNT + THEME
============================================================ */
async function saveAllPrizes() {
    // Collect updated prize values
    const inputs = document.querySelectorAll("#prizeListContainer input");
    PRIZES = Array.from(inputs).map(i => i.value.trim()).filter(x => x);

    DISPLAY_COUNT = parseInt(document.getElementById("displayCountInput").value) || PRIZES.length;

    const payload = {
        prizes: PRIZES,
        displayCount: DISPLAY_COUNT,
        theme: CURRENT_THEME
    };

    await fetch(API_SAVE_PRIZES, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
    });

    alert("Saved successfully! The wheel will update.");
    loadGlobalSettings();
}

async function saveDisplayCount() {
    await saveAllPrizes();
}

/* ============================================================
   RESET SPIN LIMITS
============================================================ */
function resetLocalSpinLimit() {
    localStorage.setItem("spinsToday", 0);
    localStorage.setItem("spinDate", "");
    alert("Local browser spins reset.");
}

function broadcastGlobalSpinReset() {
    // Very simple: notify all future loads to ignore previous limits.
    localStorage.setItem("globalSpinReset", Date.now().toString());
    alert("Global spin reset broadcasted. Users will reset next visit.");
}

/* ============================================================
   LOAD WINNERS LIST (Today's winners)
============================================================ */
async function loadWinners() {
    const container = document.getElementById("winnersContainer");
    container.innerHTML = "Loading...";

    try {
        const res = await fetch(API_WINNERS);
        const data = await res.json();

        if (!data.length) {
            container.innerHTML = "<p>No winners today.</p>";
            return;
        }

        let html = `
            <table class="winners-table">
                <tr><th>Name</th><th>Prize</th><th>Time</th></tr>
        `;
        data.forEach(entry => {
            html += `<tr>
                        <td>${entry.name}</td>
                        <td>${entry.prize}</td>
                        <td>${entry.time}</td>
                    </tr>`;
        });
        html += "</table>";

        container.innerHTML = html;

    } catch (e) {
        container.innerHTML = "<p>Error loading winners.</p>";
    }
}
/* ============================================================
   WHEEL + SPINNING LOGIC
============================================================ */
const wheelCanvas = document.getElementById("wheelCanvas");
const wheelCtx = wheelCanvas.getContext("2d");
let currentRotation = 0;

// Draw wheel
function drawWheel() {
    const width = wheelCanvas.width;
    const height = wheelCanvas.height;
    const cx = width / 2;
    const cy = height / 2;
    const radius = Math.min(cx, cy) - 10;

    wheelCtx.clearRect(0, 0, width, height);

    const sliceAngle = (2 * Math.PI) / DISPLAY_COUNT;
    for (let i = 0; i < DISPLAY_COUNT; i++) {
        const start = i * sliceAngle + currentRotation;
        const end = start + sliceAngle;

        // Color slice
        wheelCtx.beginPath();
        wheelCtx.moveTo(cx, cy);
        wheelCtx.arc(cx, cy, radius, start, end);
        wheelCtx.closePath();
        wheelCtx.fillStyle = `hsl(${(i / DISPLAY_COUNT) * 360}, 75%, 55%)`;
        wheelCtx.fill();

        // Label
        wheelCtx.save();
        wheelCtx.translate(cx, cy);
        wheelCtx.rotate(start + sliceAngle / 2);
        wheelCtx.textAlign = "right";
        wheelCtx.fillStyle = "white";
        wheelCtx.font = "bold 18px sans-serif";
        wheelCtx.fillText(PRIZES[i] || "", radius - 20, 6);
        wheelCtx.restore();
    }
}

/* ============================================================
   ANGLE â†’ PRIZE INDEX
============================================================ */
function angleToIndex(angle) {
    const sliceAngle = (2 * Math.PI) / DISPLAY_COUNT;
    const normalized =
        ((-angle + Math.PI / 2) % (2 * Math.PI) + 2 * Math.PI) % (2 * Math.PI);
    return Math.floor(normalized / sliceAngle) % DISPLAY_COUNT;
}

/* ============================================================
   SPIN LIMIT PER USER
============================================================ */
function getToday() {
    const d = new Date();
    return `${d.getFullYear()}-${d.getMonth() + 1}-${d.getDate()}`;
}

function loadSpinData() {
    const today = getToday();
    const savedDate = localStorage.getItem("spinDate");
    if (savedDate !== today || localStorage.getItem("globalSpinReset")) {
        localStorage.setItem("spinDate", today);
        localStorage.setItem("spinsToday", "0");
        return 0;
    }
    return parseInt(localStorage.getItem("spinsToday") || "0");
}

function incrementSpin() {
    const spins = loadSpinData();
    localStorage.setItem("spinsToday", spins + 1);
}

/* Show exhausted modal */
function closeLimitModal() {
    document.getElementById("limitModal").style.display = "none";
}

/* ============================================================
   SOUND SYSTEM
============================================================ */
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function clickSound() {
    let o = audioCtx.createOscillator();
    let g = audioCtx.createGain();
    o.frequency.value = 900;
    g.gain.value = 0.15;
    o.connect(g).connect(audioCtx.destination);
    o.start();
    o.stop(audioCtx.currentTime + 0.05);
}

let tickingInterval = null;
function startTicking() {
    tickingInterval = setInterval(() => clickSound(), 120);
}
function stopTicking() {
    clearInterval(tickingInterval);
}

/* Win sound */
function popSound() {
    let o = audioCtx.createOscillator();
    let g = audioCtx.createGain();
    o.frequency.setValueAtTime(300, audioCtx.currentTime);
    o.frequency.exponentialRampToValueAtTime(60, audioCtx.currentTime + 0.25);
    g.gain.setValueAtTime(0.4, audioCtx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.25);
    o.connect(g).connect(audioCtx.destination);
    o.start();
    o.stop(audioCtx.currentTime + 0.25);
}

/* ============================================================
   CONFETTI ENGINE
============================================================ */
const confettiCanvas = document.getElementById("confettiCanvas");
const confCtx = confettiCanvas.getContext("2d");

function resizeConfetti() {
    confettiCanvas.width = window.innerWidth;
    confettiCanvas.height = window.innerHeight;
}
resizeConfetti();
window.addEventListener("resize", resizeConfetti);

let confettiPieces = [];

function launchConfetti() {
    confettiPieces = [];
    for (let i = 0; i < 200; i++) {
        confettiPieces.push({
            x: Math.random() * confettiCanvas.width,
            y: Math.random() * confettiCanvas.height - confettiCanvas.height,
            size: Math.random() * 8 + 3,
            color: `hsl(${Math.random() * 360}, 80%, 60%)`,
            speed: Math.random() * 3 + 2,
            rotation: Math.random() * 360
        });
    }
    animateConfetti();
}

function animateConfetti() {
    confCtx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);

    confettiPieces.forEach(p => {
        p.y += p.speed;
        p.rotation += 4;

        if (p.y < confettiCanvas.height) {
            confCtx.save();
            confCtx.translate(p.x, p.y);
            confCtx.rotate(p.rotation * Math.PI / 180);
            confCtx.fillStyle = p.color;
            confCtx.fillRect(-p.size / 2, -p.size / 2, p.size, p.size);
            confCtx.restore();
        }
    });

    requestAnimationFrame(animateConfetti);
}

/* ============================================================
   SPIN WHEEL
============================================================ */
async function spinWheel() {
    const username = document.getElementById("usernameInput").value.trim();
    if (!username) {
        alert("Please enter your name.");
        return;
    }

    // Spin limit check
    const spins = loadSpinData();
    if (spins >= 3) {
        document.getElementById("limitModal").style.display = "flex";
        return;
    }

    audioCtx.resume();
    clickSound();
    startTicking();
    document.getElementById("spinButton").disabled = true;

    let extraSpins = Math.random() * 8 + 6;
    let offset = Math.random() * 2 * Math.PI;
    let target = currentRotation + extraSpins * 2 * Math.PI + offset;

    const duration = 3800;
    const startTime = performance.now();
    const startRot = currentRotation;

    function easeOut(t) {
        return 1 - Math.pow(1 - t, 3);
    }

    function animate(now) {
        const t = Math.min(1, (now - startTime) / duration);
        currentRotation = startRot + (target - startRot) * easeOut(t);
        drawWheel();

        if (t < 1) {
            requestAnimationFrame(animate);
        } else {
            stopTicking();
            const index = angleToIndex(currentRotation);
            const prize = PRIZES[index];

            popSound();
            launchConfetti();

            incrementSpin();

            document.getElementById("resultDisplay").innerHTML =
                `<strong>${username}</strong> won <strong>${prize}</strong> ðŸŽ‰`;

            logResult(username, prize);

            document.getElementById("spinButton").disabled = false;
        }
    }

    requestAnimationFrame(animate);
}

/* ============================================================
   LOG RESULTS TO GOOGLE FORM (unchanged)
============================================================ */
async function logResult(name, prize) {
    document.getElementById("logStatus").innerText = "Logging...";

    const FORM_URL =
      "https://docs.google.com/forms/d/e/1FAIpQLScmIOGE31UP637G0UNNnxXIFMt33ECnIc4vk3QyyYE86yi8og/formResponse";

    const form = new FormData();
    form.append("entry.2073447998", name);
    form.append("entry.147622954", prize);
    form.append("entry.1151054090", new Date().toISOString());

    await fetch(FORM_URL, {
        method: "POST",
        mode: "no-cors",
        body: form
    });

    document.getElementById("logStatus").innerText = "Logged âœ”";
}
/* ============================================================
   INITIALIZATION
============================================================ */

// Enable spin button only when name is entered
document.getElementById("usernameInput").addEventListener("input", () => {
    document.getElementById("spinButton").disabled =
        document.getElementById("usernameInput").value.trim() === "";
});

// Spin button click
document.getElementById("spinButton").addEventListener("click", spinWheel);

// Load global settings and draw wheel on startup
loadGlobalSettings();

</script>

</body>
</html>
