<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Spin the Wheel</title>

<style>
:root {
  --bg-light: linear-gradient(135deg, #f5f7fa, #e4ebf5);
  --bg-dark: linear-gradient(135deg, #0f1220, #1b1f36);
  --text-light: #222;
  --text-dark: #fff;
}

body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: var(--bg-dark);
  color: var(--text-dark);
  min-height: 100vh;
  display: flex;
  justify-content: center;
}

body.light {
  background: var(--bg-light);
  color: var(--text-light);
}

.container {
  width: 100%;
  max-width: 420px;
  padding: 16px;
  text-align: center;
}

/* Theme toggle */
.theme-toggle {
  position: fixed;
  top: 12px;
  right: 12px;
  padding: 8px 12px;
  border-radius: 20px;
  border: none;
  cursor: pointer;
}

/* Wheel */
#wheelWrap {
  position: relative;
  width: 320px;
  height: 320px;
  margin: 20px auto;
}

#pointer {
  position: absolute;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 0;
  height: 0;
  border-left: 14px solid transparent;
  border-right: 14px solid transparent;
  border-top: 26px solid currentColor;
  z-index: 5;
}

#wheelSVG {
  width: 100%;
  height: 100%;
  transition: transform 4s cubic-bezier(.25,.8,.25,1);
}

/* Controls */
input {
  width: 100%;
  padding: 12px;
  border-radius: 8px;
  border: none;
  margin-bottom: 12px;
}

button.spin {
  width: 100%;
  padding: 14px;
  border-radius: 10px;
  border: none;
  font-size: 18px;
  background: #ff4d4d;
  color: white;
  cursor: pointer;
}

#result {
  margin-top: 14px;
  font-weight: bold;
}
</style>
</head>

<body>
<button class="theme-toggle" onclick="toggleTheme()">ðŸŒ“</button>

<div class="container">
  <h2>Spin the Wheel ðŸŽ‰</h2>

  <div id="wheelWrap">
    <div id="pointer"></div>
    <svg id="wheelSVG" viewBox="0 0 500 500"></svg>
  </div>

  <input id="nameInput" placeholder="Enter your name" />
  <button class="spin" onclick="spinWheel()">Spin the Wheel</button>

  <div id="result"></div>
</div>

<script>
/* ==============================
   CONFIG
============================== */
const SHEET_ID = "19YjtZAaasx8_xzSC-TJje7yxT00g3HcjloaLK31bjKY";
const FORM_ENDPOINT =
"https://docs.google.com/forms/d/e/1FAIpQLScmIOGE31UP637G0UNNnxXIFMt33ECnIc4vk3QyyYE86yi8og/formResponse";

/* ==============================
   THEME
============================== */
function toggleTheme() {
  document.body.classList.toggle("light");
}

/* ==============================
   LOAD PRIZES
============================== */
let prizes = [];
let rotation = 0;

async function loadPrizes() {
  try {
    const url =
      `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=PrizeList`;
    const res = await fetch(url);
    const text = await res.text();
    const json = JSON.parse(text.substr(47).slice(0, -2));
    prizes = json.table.rows.map(r => r.c[0]?.v).filter(Boolean);
  } catch {
    prizes = [];
  }

  if (prizes.length === 0) {
    prizes = ["Prize A","Prize B","Prize C","Prize D","Prize E","Prize F"];
  }
  drawWheel();
}

/* ==============================
   DRAW SVG WHEEL
============================== */
function drawWheel() {
  const svg = document.getElementById("wheelSVG");
  svg.innerHTML = "";

  const cx = 250, cy = 250, r = 240;
  const slice = 2 * Math.PI / prizes.length;

  prizes.forEach((label, i) => {
    const start = i * slice;
    const end = start + slice;

    const x1 = cx + r * Math.cos(start);
    const y1 = cy + r * Math.sin(start);
    const x2 = cx + r * Math.cos(end);
    const y2 = cy + r * Math.sin(end);

    const path = document.createElementNS("http://www.w3.org/2000/svg","path");
    path.setAttribute("d",
      `M ${cx} ${cy} L ${x1} ${y1} A ${r} ${r} 0 0 1 ${x2} ${y2} Z`);
    path.setAttribute("fill",
      `hsl(${(i / prizes.length) * 360}, 75%, 55%)`);
    svg.appendChild(path);

    const angle = start + slice / 2;
    const tx = cx + (r - 40) * Math.cos(angle);
    const ty = cy + (r - 40) * Math.sin(angle);

    const text = document.createElementNS("http://www.w3.org/2000/svg","text");
    text.textContent = label;
    text.setAttribute("x", tx);
    text.setAttribute("y", ty);
    text.setAttribute("fill", "white");
    text.setAttribute("font-size", "16");
    text.setAttribute("text-anchor", "middle");
    text.setAttribute("dominant-baseline", "middle");
    text.setAttribute(
      "transform",
      `rotate(${angle * 180 / Math.PI}, ${tx}, ${ty})`
    );
    svg.appendChild(text);
  });
}

/* ==============================
   SPIN + LOG
============================== */
function spinWheel() {
  const name = nameInput.value.trim();
  if (!name) return alert("Enter your name");

  const spins = Math.random() * 360 + 1800;
  rotation += spins;
  wheelSVG.style.transform = `rotate(${rotation}deg)`;

  const sliceDeg = 360 / prizes.length;
  const index = Math.floor(
    ((360 - (rotation % 360)) % 360) / sliceDeg
  );

  setTimeout(() => {
    const prize = prizes[index];
    result.textContent = `${name} won ${prize} ðŸŽ‰`;
    logResult(name, prize);
  }, 4000);
}

/* ==============================
   GOOGLE FORM LOG
============================== */
function logResult(name, prize) {
  const data = new FormData();
  data.append("entry.2073447998", name);
  data.append("entry.147622954", prize);
  data.append("entry.1151054090", new Date().toISOString());

  fetch(FORM_ENDPOINT, { method: "POST", body: data, mode: "no-cors" });
}

/* INIT */
loadPrizes();
</script>
</body>
</html>
