<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Spin & Win</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />

<style>
/* -------------------------------------------------
   GLOBAL + BACKGROUND ANIMATION
--------------------------------------------------*/
html, body {
  margin:0;
  height:100%;
  overflow:hidden;
  font-family: Inter, sans-serif;
  background: radial-gradient(circle at top, #0d1b3d, #070b16 70%);
  animation:bgMove 16s infinite alternate ease-in-out;
  color:white;
  display:flex;
  align-items:center;
  justify-content:center;
}
@keyframes bgMove {
  0% { background-position: 0px 0px; filter: hue-rotate(0deg); }
  100% { background-position: 0px 400px; filter: hue-rotate(25deg); }
}

/* -------------------------------------------------
   CONTAINER
--------------------------------------------------*/
.container {
  width:900px;
  max-width:95%;
  background:rgba(255,255,255,0.05);
  border-radius:16px;
  padding:24px;
  backdrop-filter: blur(8px);
  box-shadow:0 10px 40px rgba(0,0,0,0.6);
  display:grid;
  grid-template-columns:360px 1fr;
  gap:24px;
  z-index:10;
  position:relative;
}

/* -------------------------------------------------
   INPUT + BUTTON
--------------------------------------------------*/
label { display:block; font-size:14px; opacity:0.8; margin-bottom:6px; }
input {
  width:100%; padding:10px 12px; border-radius:8px; border:none;
  background:rgba(255,255,255,0.1); color:white; font-size:16px;
}
button {
  width:100%; margin-top:16px; padding:12px;
  border:none; border-radius:10px;
  background:linear-gradient(90deg,#ff4f4f,#ff2f2f);
  color:white; font-size:18px; font-weight:600;
  cursor:pointer; transition:0.2s;
}
button:disabled { opacity:0.5; cursor:not-allowed; }

/* Button shake when limit reached */
@keyframes shake {
  0% { transform:translateX(0); }
  25% { transform:translateX(-6px); }
  50% { transform:translateX(6px); }
  75% { transform:translateX(-6px); }
  100% { transform:translateX(0); }
}
.shake { animation:shake 0.4s ease; }

/* Red glowing button when exhausted */
.exhausted {
  box-shadow:0 0 20px #ff0000;
}

/* -------------------------------------------------
   POINTER (GLOWING)
--------------------------------------------------*/
.pointer {
  width:0; height:0;
  border-left:15px solid transparent;
  border-right:15px solid transparent;
  border-bottom:30px solid #fff;
  margin:10px auto 0;
  position:relative;
  animation:pointerGlow 1.4s infinite alternate;
}
@keyframes pointerGlow {
  0% { filter: drop-shadow(0 0 4px #ff4f4f); }
  100% { filter: drop-shadow(0 0 12px #ff2f2f); }
}

/* -------------------------------------------------
   POPUP MODAL
--------------------------------------------------*/
#limitModal {
  position:fixed;
  top:0; left:0; width:100%; height:100%;
  display:flex; align-items:center; justify-content:center;
  background:rgba(0,0,0,0.6);
  backdrop-filter:blur(4px);
  z-index:999;
  opacity:0; pointer-events:none;
  transition:0.3s;
}
#limitModal.active {
  opacity:1; pointer-events:auto;
}
.modal-box {
  background:#200; padding:30px 40px;
  border-radius:12px; text-align:center;
  box-shadow:0 0 25px #f00;
  animation:modalPop 0.35s ease-out;
}
@keyframes modalPop {
  0% { transform:scale(0.6); opacity:0; }
  100% { transform:scale(1); opacity:1; }
}
.modal-box h2 {
  font-size:26px;
  margin:0 0 10px;
  color:#ff4f4f;
}

/* -------------------------------------------------
   CONFETTI CANVAS
--------------------------------------------------*/
#confettiCanvas {
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  pointer-events:none;
  z-index:5;
}

/* -------------------------------------------------
   RESPONSIVE
--------------------------------------------------*/
@media(max-width:850px){
  .container { grid-template-columns:1fr; }
}
</style>
</head>

<body>

<!-- CONFETTI CANVAS -->
<canvas id="confettiCanvas"></canvas>

<!-- LIMIT POPUP -->
<div id="limitModal">
  <div class="modal-box">
    <h2>Oops! Spin Limit Exhausted</h2>
    <p>Youâ€™ve reached your 3 spins for today. Try again tomorrow!</p>
    <button onclick="closeModal()">OK</button>
  </div>
</div>

<!-- MAIN UI -->
<div class="container">

  <!-- LEFT SIDE -->
  <div>
    <h1>Spin & Win ðŸŽ‰</h1>

    <label>Your Name</label>
    <input id="participantName" placeholder="Enter your name" />

    <button id="spinBtn" disabled>Spin the Wheel</button>

    <div id="lastResult" style="margin-top:14px; opacity:0.8;"></div>
    <div id="logMsg" style="margin-top:8px; color:#98ffae;"></div>
  </div>

  <!-- RIGHT SIDE -->
  <div style="text-align:center;">
    <canvas id="wheelCanvas" width="420" height="420"></canvas>
    <div class="pointer"></div>
  </div>

</div>

<script>
(() => {

/* ---------------------------------------------------------------
   PRIZES (A â†’ Z)
---------------------------------------------------------------*/
const PRIZES = [
  "Prize A", "Prize B", "Prize C", "Prize D", "Prize E", "Prize F",
  "Prize G", "Prize H", "Prize I", "Prize J", "Prize K", "Prize L",
  "Prize M", "Prize N", "Prize O", "Prize P", "Prize Q", "Prize R",
  "Prize S", "Prize T", "Prize U", "Prize V", "Prize W", "Prize X",
  "Prize Y", "Prize Z"
];

/* ---------------------------------------------------------------
   GOOGLE FORM SETTINGS
---------------------------------------------------------------*/
const GOOGLE_FORM_ACTION =
  "https://docs.google.com/forms/d/e/1FAIpQLScmIOGE31UP637G0UNNnxXIFMt33ECnIc4vk3QyyYE86yi8og/formResponse";
const FIELD_IDS = {
  name: "entry.2073447998",
  result: "entry.147622954",
  timestamp: "entry.1151054090"
};

/* ---------------------------------------------------------------
   ELEMENTS
---------------------------------------------------------------*/
const wheelCanvas = document.getElementById("wheelCanvas");
const ctx = wheelCanvas.getContext("2d");
const spinBtn = document.getElementById("spinBtn");
const nameInput = document.getElementById("participantName");
const lastResult = document.getElementById("lastResult");
const logMsg = document.getElementById("logMsg");
const confettiCanvas = document.getElementById("confettiCanvas");
const confCtx = confettiCanvas.getContext("2d");

/* ---------------------------------------------------------------
   SPIN LIMIT SYSTEM â€” 3 spins per browser/day
---------------------------------------------------------------*/
function getToday() {
  const d = new Date();
  return `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;
}

function loadSpinData() {
  const savedDate = localStorage.getItem("spinDate");
  const today = getToday();

  if (savedDate !== today) {
    localStorage.setItem("spinDate", today);
    localStorage.setItem("spinsToday", 0);
    return 0;
  }
  return parseInt(localStorage.getItem("spinsToday") || 0);
}

function incrementSpin() {
  let count = loadSpinData();
  count++;
  localStorage.setItem("spinsToday", count);
  return count;
}

function showSpinLimitPopup() {
  spinBtn.classList.add("shake", "exhausted");
  document.getElementById("limitModal").classList.add("active");
  setTimeout(() => spinBtn.classList.remove("shake"), 600);
}

window.closeModal = function() {
  document.getElementById("limitModal").classList.remove("active");
};

/* ---------------------------------------------------------------
   CONFETTI EFFECT
---------------------------------------------------------------*/
let confetti = [];
function resizeConfetti() {
  confettiCanvas.width = window.innerWidth;
  confettiCanvas.height = window.innerHeight;
}
window.addEventListener("resize", resizeConfetti);
resizeConfetti();

function launchConfetti() {
  confetti = [];
  for (let i = 0; i < 200; i++) {
    confetti.push({
      x: Math.random()*confettiCanvas.width,
      y: Math.random()*-confettiCanvas.height,
      size: Math.random()*8+3,
      color: `hsl(${Math.random()*360}, 75%, 60%)`,
      speed: Math.random()*3+2,
      rotation: Math.random()*360
    });
  }
  animateConfetti();
}

function animateConfetti() {
  confCtx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
  confetti.forEach(c => {
    c.y += c.speed;
    c.rotation += 4;
    if(c.y < confettiCanvas.height){
      confCtx.save();
      confCtx.translate(c.x,c.y);
      confCtx.rotate(c.rotation*Math.PI/180);
      confCtx.fillStyle = c.color;
      confCtx.fillRect(-c.size/2,-c.size/2,c.size,c.size);
      confCtx.restore();
    }
  });
  requestAnimationFrame(animateConfetti);
}

/* ---------------------------------------------------------------
   SOUND SYSTEM
---------------------------------------------------------------*/
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function clickSound() {
  let o = audioCtx.createOscillator();
  let g = audioCtx.createGain();
  o.frequency.value = 900;
  g.gain.value = 0.15;
  o.connect(g).connect(audioCtx.destination);
  o.start(); o.stop(audioCtx.currentTime + 0.04);
}

function tickingStart() {
  window.__tick = setInterval(() => clickSound(), 100);
}
function tickingStop() {
  clearInterval(window.__tick);
}

function popSound() {
  let o = audioCtx.createOscillator();
  let g = audioCtx.createGain();
  o.frequency.setValueAtTime(300, audioCtx.currentTime);
  o.frequency.exponentialRampToValueAtTime(60, audioCtx.currentTime+0.2);
  g.gain.setValueAtTime(0.4,audioCtx.currentTime);
  g.gain.exponentialRampToValueAtTime(0.01,audioCtx.currentTime+0.2);
  o.connect(g).connect(audioCtx.destination);
  o.start(); o.stop(audioCtx.currentTime+0.2);
}

/* ---------------------------------------------------------------
   WHEEL DRAWING
---------------------------------------------------------------*/
let currentRotation = 0;
const sliceAngle = (2*Math.PI) / PRIZES.length;

function drawWheel() {
  const size = wheelCanvas.width;
  const cx=size/2, cy=size/2, r=cx-10;
  ctx.clearRect(0,0,size,size);

  for(let i=0;i<PRIZES.length;i++){
    const start=i*sliceAngle, end=start+sliceAngle;

    ctx.beginPath();
    ctx.moveTo(cx,cy);
    ctx.arc(cx,cy,r,start+currentRotation,end+currentRotation);
    ctx.closePath();
    ctx.fillStyle=`hsl(${(i/PRIZES.length)*360},70%,55%)`;
    ctx.fill();

    ctx.save();
    ctx.translate(cx,cy);
    ctx.rotate((start+end)/2+currentRotation);
    ctx.textAlign="right";
    ctx.fillStyle="white";
    ctx.font="bold 14px sans-serif";
    ctx.fillText(PRIZES[i], r-22,5);
    ctx.restore();
  }
}

function angleToIndex(angle){
  const normalized=(( -angle + Math.PI/2 )%(2*Math.PI)+2*Math.PI)%(2*Math.PI);
  return Math.floor(normalized/sliceAngle)%PRIZES.length;
}

/* ---------------------------------------------------------------
   SPIN FUNCTION
---------------------------------------------------------------*/
function spinWheel() {
  const spins = loadSpinData();
  if (spins >= 3) {
    showSpinLimitPopup();
    return;
  }

  const name = nameInput.value.trim();
  if (!name) {
    alert("Please enter your name.");
    return;
  }

  audioCtx.resume();
  clickSound();
  tickingStart();

  spinBtn.disabled=true;

  let extra=Math.random()*8+6;
  let offset=Math.random()*2*Math.PI;
  let target=currentRotation + extra*2*Math.PI + offset;
  let duration=3500;
  let start=performance.now();
  let startRot=currentRotation;

  function ease(t){return 1-Math.pow(1-t,3);}

  function frame(now){
    const t=Math.min(1,(now-start)/duration);
    currentRotation=startRot+(target-startRot)*ease(t);
    drawWheel();

    if(t<1){ requestAnimationFrame(frame); }
    else {
      tickingStop();
      const result=PRIZES[angleToIndex(currentRotation)];
      lastResult.innerHTML=`<strong>${result}</strong> â€” won by ${name}`;
      popSound();
      launchConfetti();
      incrementSpin();
      sendResult(name,result);
      spinBtn.disabled=false;
    }
  }
  requestAnimationFrame(frame);
}

/* ---------------------------------------------------------------
   LOGGING
---------------------------------------------------------------*/
async function sendResult(name,result){
  logMsg.textContent="Logging...";
  const form=new FormData();
  form.append(FIELD_IDS.name,name);
  form.append(FIELD_IDS.result,result);
  form.append(FIELD_IDS.timestamp,new Date().toISOString());
  form.append("entry_options_backup", PRIZES.join("\n"));
  await fetch(GOOGLE_FORM_ACTION,{method:"POST",mode:"no-cors",body:form});
  logMsg.textContent="Logged âœ”";
}

/* ---------------------------------------------------------------
   INITIALIZATION
---------------------------------------------------------------*/
nameInput.addEventListener("input",()=>{
  spinBtn.disabled=nameInput.value.trim()==="";
});
spinBtn.addEventListener("click",spinWheel);

drawWheel();

})();
</script>

</body>
</html>
