<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Spin the Wheel</title>

<style>
:root {
  --bg-dark: linear-gradient(135deg, #0f1220, #1b1f36);
  --bg-light: linear-gradient(135deg, #f3f6fb, #e4ebf5);
  --text-dark: #ffffff;
  --text-light: #222222;
  --accent: #ff4d4d;
}

body {
  margin: 0;
  font-family: system-ui, sans-serif;
  min-height: 100vh;
  background: var(--bg-dark);
  color: var(--text-dark);
  display: flex;
  justify-content: center;
}

body.light {
  background: var(--bg-light);
  color: var(--text-light);
}

.container {
  width: 100%;
  max-width: 420px;
  padding: 18px;
  text-align: center;
}

.theme-toggle {
  position: fixed;
  top: 12px;
  right: 12px;
  padding: 8px 14px;
  border-radius: 20px;
  border: none;
  cursor: pointer;
  font-size: 16px;
}

/* Wheel */
#wheelWrap {
  position: relative;
  width: 320px;
  height: 320px;
  margin: 28px auto 20px;
}

/* Downward Pointer (PREMIUM) */
#pointer {
  position: absolute;
  top: -10px;
  left: 50%;
  transform: translateX(-50%);
  width: 0;
  height: 0;
  border-left: 16px solid transparent;
  border-right: 16px solid transparent;
  border-top: 30px solid var(--accent);
  filter: drop-shadow(0 0 6px rgba(255,77,77,0.7));
  z-index: 10;
}

/* Wheel SVG */
#wheelSVG {
  width: 100%;
  height: 100%;
  transition: transform 4s cubic-bezier(.25,.8,.25,1);
  border-radius: 50%;
  box-shadow: 0 10px 30px rgba(0,0,0,0.4);
}

/* Center Hub */
#hub {
  position: absolute;
  inset: 50%;
  width: 22px;
  height: 22px;
  background: #fff;
  border-radius: 50%;
  transform: translate(-50%, -50%);
  z-index: 5;
}

/* Form */
label {
  display: block;
  text-align: left;
  margin-bottom: 6px;
  font-weight: 600;
}

input, button.spin {
  width: 100%;
  padding: 14px;
  font-size: 16px;
  border-radius: 10px;
  border: none;
  box-sizing: border-box;
}

input {
  margin-bottom: 12px;
}

button.spin {
  font-size: 18px;
  background: var(--accent);
  color: white;
  cursor: pointer;
}

#result {
  margin-top: 16px;
  font-weight: 700;
}
</style>
</head>

<body>
<button class="theme-toggle" onclick="toggleTheme()">ðŸŒ“</button>

<div class="container">
  <h2>Spin the Wheel ðŸŽ‰</h2>

  <div id="wheelWrap">
    <div id="pointer"></div>
    <svg id="wheelSVG" viewBox="0 0 500 500"></svg>
    <div id="hub"></div>
  </div>

  <label for="nameInput">Your Name</label>
  <input id="nameInput" placeholder="Required to spin" />
  <button class="spin" onclick="spinWheel()">Spin the Wheel</button>

  <div id="result"></div>
</div>

<script>
/* =========================
   CONFIG
========================= */
const SHEET_ID = "19YjtZAaasx8_xzSC-TJje7yxT00g3HcjloaLK31bjKY";
const FORM_ENDPOINT =
"https://docs.google.com/forms/d/e/1FAIpQLScmIOGE31UP637G0UNNnxXIFMt33ECnIc4vk3QyyYE86yi8og/formResponse";

/* =========================
   THEME
========================= */
function toggleTheme() {
  document.body.classList.toggle("light");
}

/* =========================
   AUDIO
========================= */
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function clickSound() {
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.frequency.value = 900;
  g.gain.value = 0.08;
  o.connect(g).connect(audioCtx.destination);
  o.start();
  o.stop(audioCtx.currentTime + 0.05);
}

let tickTimer;
function startTick() {
  tickTimer = setInterval(() => {
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.frequency.value = 480;
    g.gain.value = 0.05;
    o.connect(g).connect(audioCtx.destination);
    o.start();
    o.stop(audioCtx.currentTime + 0.03);
  }, 120);
}
function stopTick() {
  clearInterval(tickTimer);
}

function winSound() {
  for (let i = 0; i < 3; i++) {
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = "triangle";
    o.frequency.value = 600 + i * 300;
    g.gain.value = 0.12;
    o.connect(g).connect(audioCtx.destination);
    o.start(audioCtx.currentTime + i * 0.08);
    o.stop(audioCtx.currentTime + i * 0.25);
  }
}

/* =========================
   CONFETTI
========================= */
function confetti() {
  for (let i = 0; i < 90; i++) {
    const c = document.createElement("div");
    c.style.position = "fixed";
    c.style.left = Math.random() * 100 + "vw";
    c.style.top = "-10px";
    c.style.width = "8px";
    c.style.height = "8px";
    c.style.borderRadius = "50%";
    c.style.background = `hsl(${Math.random()*360},80%,60%)`;
    c.style.zIndex = 9999;
    document.body.appendChild(c);

    c.animate([
      { transform: "translateY(0)" },
      { transform: `translateY(${window.innerHeight + 100}px)` }
    ], {
      duration: 1800 + Math.random()*1200,
      easing: "ease-out"
    }).onfinish = () => c.remove();
  }
}

/* =========================
   PRIZES
========================= */
let prizes = [];
let rotation = 0;

async function loadPrizes() {
  try {
    const url =
      `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=PrizeList`;
    const res = await fetch(url);
    const text = await res.text();
    const json = JSON.parse(text.substr(47).slice(0, -2));
    prizes = json.table.rows.map(r => r.c[0]?.v).filter(Boolean);
  } catch {}

  if (prizes.length === 0) {
    prizes = ["Prize A","Prize B","Prize C","Prize D","Prize E","Prize F"];
  }
  drawWheel();
}

/* =========================
   SVG WHEEL
========================= */
function drawWheel() {
  wheelSVG.innerHTML = "";

  const cx = 250, cy = 250, r = 240;
  const slice = 2 * Math.PI / prizes.length;

  prizes.forEach((label, i) => {
    const start = i * slice;
    const end = start + slice;

    const x1 = cx + r * Math.cos(start);
    const y1 = cy + r * Math.sin(start);
    const x2 = cx + r * Math.cos(end);
    const y2 = cy + r * Math.sin(end);

    const path = document.createElementNS("http://www.w3.org/2000/svg","path");
    path.setAttribute("d",
      `M ${cx} ${cy} L ${x1} ${y1} A ${r} ${r} 0 0 1 ${x2} ${y2} Z`);
    path.setAttribute("fill",
      `hsl(${(i / prizes.length) * 360},75%,55%)`);
    wheelSVG.appendChild(path);

    const angle = start + slice / 2;
    const tx = cx + (r - 40) * Math.cos(angle);
    const ty = cy + (r - 40) * Math.sin(angle);

    const text = document.createElementNS("http://www.w3.org/2000/svg","text");
    text.textContent = label;
    text.setAttribute("x", tx);
    text.setAttribute("y", ty);
    text.setAttribute("fill", "white");
    text.setAttribute("font-size", "16");
    text.setAttribute("text-anchor", "middle");
    text.setAttribute("dominant-baseline", "middle");
    text.setAttribute(
      "transform",
      `rotate(${angle * 180 / Math.PI}, ${tx}, ${ty})`
    );
    wheelSVG.appendChild(text);
  });
}

/* =========================
   SPIN + CORRECT MATH
========================= */
function spinWheel() {
  const name = nameInput.value.trim();
  if (!name) return alert("Your name is required");

  audioCtx.resume();
  clickSound();
  startTick();

  const spins = Math.random() * 360 + 1800;
  rotation += spins;
  wheelSVG.style.transform = `rotate(${rotation}deg)`;

  const sliceDeg = 360 / prizes.length;

  setTimeout(() => {
    stopTick();
    winSound();
    confetti();

    // ðŸŽ¯ POINTER IS DOWNWARD (0Â°), SVG 0Â° is right â†’ offset +90Â°
    const normalized =
      (360 - ((rotation + 90) % 360) + 360) % 360;

    const index = Math.floor(normalized / sliceDeg);
    const prize = prizes[index];

    result.textContent = `${name} won ${prize} ðŸŽ‰`;
    logResult(name, prize);
  }, 4000);
}

/* =========================
   GOOGLE FORM LOG
========================= */
function logResult(name, prize) {
  const data = new FormData();
  data.append("entry.2073447998", name);
  data.append("entry.147622954", prize);
  data.append("entry.1151054090", new Date().toISOString());
  fetch(FORM_ENDPOINT, { method: "POST", body: data, mode: "no-cors" });
}

/* INIT */
loadPrizes();
</script>
</body>
</html>
